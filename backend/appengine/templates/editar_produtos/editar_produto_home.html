{% extends 'editar_produtos/editar_produto_base.html' %}
{% set errors=errors or None %}
{% block js %}
    <script type="text/javascript" src="/static/angular/js/angular.min.js"></script>
    <script type="text/javascript" src="/static/produto/js/produto.js"></script>
{#      <script type="text/javascript" src="/static/produto/js/produto_api_mock.js"></script>#}
    <script type="text/javascript">
        var rest = angular.module('rest',[]);
        rest.factory('ProdutoApi',function($http){
           return{
               salvar:function(produto){
                   return $http.post('/editar_produtos/rest/new',produto);
               },
               listar:function(){
                   return $http.post('{{ list_path }}');
               }
           };
        });

        var produtoApp = angular.module('produtoApp',['produtoModulo','rest']);

        function ProdutoController($scope,ProdutoApi){
            $scope.produto = {nome:'Computador',titulo:'Computador'};
            $scope.mostrarFormFlag=false;
            $scope.produtoLista = [];
            ProdutoApi.listar().success(function(produtos){
                $scope.produtoLista = produtos;
            });
            $scope.mostrarOuEsconderForm=function(){
                $scope.mostrarFormFlag=!$scope.mostrarFormFlag;
            }

        }
    </script>
{% endblock %}
{% block body %}
    <div class="container" style="background-color: #FFFFFF" >
        <div class="row">
            <div class="col-md-12" ng-app="produtoApp" ng-controller="ProdutoController">
                 <h1 class="text-center">Tabela de Produtos</h1>
                    <button class="btn btn-success" ng-click="mostrarOuEsconderForm()">Cadastrar Novo Produto</button>
                <br>
                <br>
                <produtoform ng-show="mostrarFormFlag" product="produto"></produtoform>
                <h7>categoria: </h7><input type="text" ng-model="produto.nome">
                <hr/>
                <table class="table table-striped table-hover">
                    <thead>
                        <tr cursolinha ng-repeat="p in produtoLista"  product="p"></tr>
                    </thead>
                    <tbody>
                    {% for editar_produto in editar_produtos %}
                        <tr>
                            <td><a href="{{ editar_produto.edit_path }}" class="btn btn-success btn-sm"><i
                                    class="glyphicon glyphicon-pencil"></i></a></td>
                            <td>{{ editar_produto.id }}</td>
                            <td>{{ editar_produto.creation }}</td>
                            <td>{{ editar_produto.titulo }}</td>
                            <td>{{ editar_produto.preco }}</td>
                            <td>{{ editar_produto.descricao }}</td>
                            <td>{{ editar_produto.imagem }}</td>
                            <td>{{ editar_produto.nome }}</td>
                            <td>
                                <form action="{{ editar_produto.delete_path }}" method="post" onsubmit="return confirm('{{_('Are you sure to delete? Press cancel to avoid deletion.')}}');">
                                    {{ csrf_input() }}
                                    <button class="btn btn-danger btn-sm"><i
                                            class="glyphicon glyphicon-trash"></i></button>
                                </form>
                            </td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
{% endblock %}